<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Payment | Paradise Le Tamarin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles/style.css">
  <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
</head>
<body>

  <section class="review-section">
    <div class="container">
      <h2>Confirm & Pay</h2>
      <div id="summaryDetails" class="booking-review-box"></div>
      <button onclick="payNow()">Pay 25% Advance</button>
    </div>
  </section>

  <script>
    const booking = JSON.parse(localStorage.getItem("bookingDetails"));
    const roomRates = {
      "Forest Breeze": { weekday: 2300, weekend: 2500 },
      "Nature’s King": { weekday: 2000, weekend: 2200 },
      "Super Saver Suite": { weekday: 1600, weekend: 1800 },
      "Mixed Dormitory": { weekday: 550, weekend: 650 }
    };

    function isWeekend(dateStr) {
      const date = new Date(dateStr);
      const day = date.getDay();
      return (day === 5 || day === 6); // Friday or Saturday
    }

    function getTotalDays(start, end) {
      const s = new Date(start), e = new Date(end);
      return Math.ceil((e - s) / (1000 * 60 * 60 * 24));
    }

    function calculateTotal() {
      const { roomType, checkin, checkout, guests } = booking;
      const start = new Date(checkin);
      const end = new Date(checkout);
      let total = 0;
      let current = new Date(start);

      while (current < end) {
        const key = isWeekend(current.toISOString()) ? "weekend" : "weekday";
        const rate = roomRates[roomType][key];
        total += rate * guests;
        current.setDate(current.getDate() + 1);
      }

      return Math.round(total * 1.25); // Include 25%
    }

    const totalWith25 = calculateTotal();
    const advanceAmount = Math.round(totalWith25 * 0.25);

    document.getElementById("summaryDetails").innerHTML = `
      <p><strong>Name:</strong> ${booking.name}</p>
      <p><strong>Check-in:</strong> ${booking.checkin}</p>
      <p><strong>Check-out:</strong> ${booking.checkout}</p>
      <p><strong>Room Type:</strong> ${booking.roomType}</p>
      <p><strong>Guests:</strong> ${booking.guests}</p>
      <p><strong>Total (with 25% added):</strong> ₹${totalWith25}</p>
      <p><strong>Advance to Pay Now (25%):</strong> ₹${advanceAmount}</p>
    `;

    function payNow() {
      const options = {
        key: "YOUR_RAZORPAY_KEY", // Replace with your Razorpay Key ID
        amount: advanceAmount * 100, // in paise
        currency: "INR",
        name: "Paradise Le Tamarin",
        description: "Advance Payment",
        prefill: {
          name: booking.name,
          email: booking.email,
          contact: booking.phone
        },
        theme: {
          color: "#007B5E"
        },
        handler: function (response) {
          alert("Payment Successful! Payment ID: " + response.razorpay_payment_id);
        }
      };
      const rzp = new Razorpay(options);
      rzp.open();
    }
  </script>

</body>
</html>
